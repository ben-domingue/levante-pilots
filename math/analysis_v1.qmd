---
format: html
---

```{r}
library(ltm)
library(tidyverse)
library(glue)
library(ggforce)
library(ggthemes)
library(GGally)

.font <- "Source Sans Pro"
theme_set(theme_bw(base_size = 14, base_family = .font))
theme_update(panel.grid = element_blank(),
             strip.background = element_blank(),
             legend.key = element_blank(),
             panel.border = element_blank(),
             axis.line = element_line(),
             strip.text = element_text(face = "bold"))
```

```{r}
# raw data imported in mental-rotation/analysis_v1.qmd
load(file="data_processed/2024-03-11-pilot.Rdata")
item_bank <- read_csv("data_processed/math-item-bank.csv") 
#  filter(notes!="practice")

math <- trials |> filter(task_id == "egma-math")

complete_math_subs <- math |> group_by(user_id) |> 
  summarise(n = n()) |> filter(n > 180) |> pull(user_id) 
# should be 188

math_g <- math |> filter(is.element(user_id, complete_math_subs))
```

```{r}
sort(table(math_g$trial_index))
mp <- math_g |> mutate(trial_num = )
```



```{r}
mr_rt <- mr_g |>
  mutate(angle = ifelse(angle > 180, 360 - angle, angle)) |>
  group_by(user_id, stim_set, angle, is_correct) |>
  summarise(medianRT = median(rt)) |>
  group_by(stim_set, angle, is_correct) |>
  summarise(RT = mean(medianRT, na.rm = T),
            sd = sd(medianRT, na.rm = T),
            n = n(),
            se = sd / sqrt(n))

mr_acc <- mr_g |>
  mutate(angle = ifelse(angle > 180, 360 - angle, angle)) |>
  group_by(user_id, stim_set, angle) |>
  summarise(subj_acc = mean(is_correct)) %>%
  group_by(stim_set, angle) |>
  summarise(accuracy = mean(subj_acc),
            sd = sd(subj_acc),
            n = n(),
            se = sd / sqrt(n))
```



```{r}
mr_rt |> filter(angle > 0, is.element(stim_set, c("duck", "goat", "rabbit"))) |>
  ggplot(aes(x = angle, y = RT, group = stim_set, color = stim_set)) +
  facet_wrap(. ~ is_correct) +
  geom_point(position = position_dodge(width = 0.5)) + geom_line() +
  geom_errorbar(aes(ymin = RT - se, ymax = RT + se), width = 0.1,
                position = position_dodge(width = 0.5))

mr_rt |> filter(angle > 0, is.element(stim_set, c("duck", "goat", "rabbit")), is_correct) |>
  ggplot(aes(x = angle, y = RT, group = stim_set, color = stim_set)) +
  geom_point(position = position_dodge(width = 0.5)) + geom_line() +
  geom_errorbar(aes(ymin = RT - se, ymax = RT + se), width = 0.1,
                position = position_dodge(width = 0.5))
```

